/*!
 * vue-authenticate v1.3.6
 * https://github.com/dgrubelic/vue-authenticate
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueAuthenticate=t()}(this,function(){"use strict";function e(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,o,r){return r?o.toUpperCase():o})}function t(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function r(e){return"string"==typeof e}function n(e){return"function"==typeof e}function i(e,t){return null==e||null==t?e:(Object.keys(t).forEach(function(o){"[object Object]"==Object.prototype.toString.call(t[o])?"[object Object]"!=Object.prototype.toString.call(e[o])?e[o]=t[o]:e[o]=i(e[o],t[o]):e[o]=t[o]}),e)}function s(e,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var o=[e,t].join("/");return function(e){return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}(o)}function a(e){var t="https:"===e.protocol;return e.protocol+"//"+e.hostname+":"+(e.port||(t?"443":"80"))+(/^\//.test(e.pathname)?e.pathname:"/"+e.pathname)}function u(e){var t,o,r={};return(e||"").split("&").forEach(function(e){e&&(o=e.split("="),t=decodeURIComponent(o[0]),r[t]=!o[1]||decodeURIComponent(o[1]))}),r}function p(e){var t;if("undefined"!=typeof module&&module.exports)try{t=require("buffer").Buffer}catch(e){}var o=String.fromCharCode,r=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),n=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return o(55296+(r>>>10))+o(56320+(1023&r));case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},i=function(e){return e.replace(r,n)};return(t?function(e){return(e.constructor===t.constructor?e:new t(e,"base64")).toString()}:function(e){return i(atob(e))})(String(e).replace(/[-_]/g,function(e){return"-"===e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function c(e){if(0===e.length)return{};var t={},o=new RegExp("\\s*;\\s*");return e.split(o).forEach(function(e){var o=e.split("="),r=o[0],n=o[1],i=decodeURIComponent(r),s=decodeURIComponent(n);t[i]=s}),t}function h(e){var t=e.path,o=e.domain,r=e.expires,n=e.secure;return[void 0===t||null===t?"":";path="+t,void 0===o||null===o?"":";domain="+o,void 0===r||null===r?"":";expires="+r.toUTCString(),void 0===n||null===n||!1===n?"":";secure"].join("")}function l(e,t,o){return[encodeURIComponent(e),"=",encodeURIComponent(t),h(o)].join("")}function d(){}function f(e,t){return function(){e.apply(t,arguments)}}function g(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],k(e,this)}function m(e,t){for(;3===e._state;)e=e._value;if(0===e._state)return void e._deferreds.push(t);e._handled=!0,g._immediateFn(function(){var o=1===e._state?t.onFulfilled:t.onRejected;if(null===o)return void(1===e._state?v:w)(t.promise,e._value);var r;try{r=o(e._value)}catch(e){return void w(t.promise,e)}v(t.promise,r)})}function v(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var o=t.then;if(t instanceof g)return e._state=3,e._value=t,void y(e);if("function"==typeof o)return void k(f(o,t),e)}e._state=1,e._value=t,y(e)}catch(t){w(e,t)}}function w(e,t){e._state=2,e._value=t,y(e)}function y(e){2===e._state&&0===e._deferreds.length&&g._immediateFn(function(){e._handled||g._unhandledRejectionFn(e._value)});for(var t=0,o=e._deferreds.length;t<o;t++)m(e,e._deferreds[t]);e._deferreds=null}function _(e,t,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=o}function k(e,t){var o=!1;try{e(function(e){o||(o=!0,v(t,e))},function(e){o||(o=!0,w(t,e))})}catch(e){if(o)return;o=!0,w(t,e)}}function I(e){switch(e.storageType){case"localStorage":try{return window.localStorage.setItem("testKey","test"),window.localStorage.removeItem("testKey"),new P(e.storageNamespace)}catch(e){}case"sessionStorage":try{return window.sessionStorage.setItem("testKey","test"),window.sessionStorage.removeItem("testKey"),new O(e.storageNamespace)}catch(e){}case"cookieStorage":return new S(e.cookieStorage);case"memoryStorage":default:return new E(e.storageNamespace)}}function C(e,t){if(!C.installed){C.installed=!0;var o=null;Object.defineProperties(e.prototype,{$auth:{get:function(){if(!o){if(!this.$http)throw new Error("Request handler instance not found");o=new R(this.$http,t)}return o}}})}}"function"!=typeof Object.assign&&(Object.assign=function(e,t){var o=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=o[n];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])}return r});var b=setTimeout;g.prototype.catch=function(e){return this.then(null,e)},g.prototype.then=function(e,t){var o=new this.constructor(d);return m(this,new _(e,t,o)),o},g.all=function(e){var t=Array.prototype.slice.call(e);return new g(function(e,o){function r(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(i,e)},o)}t[i]=s,0==--n&&e(t)}catch(e){o(e)}}if(0===t.length)return e([]);for(var n=t.length,i=0;i<t.length;i++)r(i,t[i])})},g.resolve=function(e){return e&&"object"==typeof e&&e.constructor===g?e:new g(function(t){t(e)})},g.reject=function(e){return new g(function(t,o){o(e)})},g.race=function(e){return new g(function(t,o){for(var r=0,n=e.length;r<n;r++)e[r].then(t,o)})},g._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){b(e,0)},g._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},g._setImmediateFn=function(e){g._immediateFn=e},g._setUnhandledRejectionFn=function(e){g._unhandledRejectionFn=e};var U={baseUrl:null,tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:window.location.hostname,path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(e){var t=e.options.tokenHeader;e.$http.interceptors.request.use(function(o){return e.isAuthenticated()?o.headers[t]=[e.options.tokenType,e.getToken()].join(" "):delete o.headers[t],o})},bindResponseInterceptor:function(e){e.$http.interceptors.response.use(function(t){return e.setToken(t),t})},providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:window.location.origin,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin,oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:window.location.origin+"/",optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:window.location.origin,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:window.location.origin,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:window.location.origin,oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:window.location.origin,authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}},S=function(e){this._defaultOptions=i({domain:window.location.hostname,expires:null,path:"/",secure:!1},e)};S.prototype.setItem=function(e,t){var o=i({},this._defaultOptions),r=l(e,t,o);this._setCookie(r)},S.prototype.getItem=function(e){var t=c(this._getCookie());return t.hasOwnProperty(e)?t[e]:null},S.prototype.removeItem=function(e){var t=i({},this._defaultOptions),o=i(t,{expires:new Date(0)}),r=l(e,"",o);this._setCookie(r)},S.prototype._getCookie=function(){return"undefined"==typeof document?"":void 0===document.cookie?"":document.cookie},S.prototype._setCookie=function(e){document.cookie=e};var P=function(e){this.namespace=e||null};P.prototype.setItem=function(e,t){window.localStorage.setItem(this._getStorageKey(e),t)},P.prototype.getItem=function(e){return window.localStorage.getItem(this._getStorageKey(e))},P.prototype.removeItem=function(e){window.localStorage.removeItem(this._getStorageKey(e))},P.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var E=function(e){this.namespace=e||null,this._storage={}};E.prototype.setItem=function(e,t){this._storage[this._getStorageKey(e)]=t},E.prototype.getItem=function(e){return this._storage[this._getStorageKey(e)]},E.prototype.removeItem=function(e){delete this._storage[this._getStorageKey(e)]},E.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var O=function(e){this.namespace=e||null};O.prototype.setItem=function(e,t){window.sessionStorage.setItem(this._getStorageKey(e),t)},O.prototype.getItem=function(e){return window.sessionStorage.getItem(this._getStorageKey(e))},O.prototype.removeItem=function(e){window.sessionStorage.removeItem(this._getStorageKey(e))},O.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var T=function(e,t,o){this.popup=null,this.url=e,this.name=t,this.popupOptions=o};T.prototype.open=function(e,t){try{if(this.popup=window.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),t)return g.resolve();window.localStorage.removeItem("custom_auth_msg");return function(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o)}(window,"message",function(e){}),this.pooling(e)}catch(e){return g.reject(new Error("OAuth popup error occurred"))}},T.prototype.pooling=function(e){var t=this;return new g(function(o,r){var n=document.createElement("a");n.href=e;var s=a(n),p=setInterval(function(){t.popup&&!t.popup.closed&&void 0!==t.popup.closed||(clearInterval(p),p=null,r(new Error("Auth popup window closed")));try{if(a(t.popup.location)===s){if(t.popup.location.search||t.popup.location.hash){var e=u(t.popup.location.search.substring(1).replace(/\/$/,"")),n=u(t.popup.location.hash.substring(1).replace(/[\/$]/,"")),c=i({},e);c=i(c,n);var h=window.localStorage.getItem("custom_auth_msg");h&&window.localStorage.removeItem("custom_auth_msg"),c.error?r(new Error(c.error)):o(c)}else r(new Error("OAuth redirect has occurred but no query or hash parameters were found."));clearInterval(p),p=null,t.popup.close()}}catch(e){var h=window.localStorage.getItem("custom_auth_msg");if(h){window.localStorage.removeItem("custom_auth_msg");var l=h.indexOf("?"),d="";if(l>0){d=h.substring(l);var f=h.indexOf("#"),g="";f>0&&(g=h.substring(f));var m=u(d.substring(1).replace(/\/$/,"")),g=u(g.substring(1).replace(/[\/$]/,"")),v=i({},m);v=i(v,g),v.error?r(new Error(v.error)):o(v),clearInterval(p),p=null,t.popup.close()}}}},250)})},T.prototype._stringifyOptions=function(){var e=this,o=[];for(var r in e.popupOptions)t(e.popupOptions[r])||o.push(r+"="+e.popupOptions[r]);return o.join(",")};var j={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}},x=function(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=i({},j),this.providerConfig=i(this.providerConfig,o),this.options=r};x.prototype.init=function(e){var t=this;return this.oauthPopup=new T("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),window&&!window.cordova&&this.oauthPopup.open(this.providerConfig.redirectUri,!0),this.getRequestToken().then(function(o){return t.openPopup(o).then(function(o){return t.exchangeForToken(o,e)})})},x.prototype.getRequestToken=function(){var e={};return e.method="POST",e[this.options.requestDataKey]=i({},this.providerConfig),e.withCredentials=this.options.withCredentials,this.options.baseUrl?e.url=s(this.options.baseUrl,this.providerConfig.url):e.url=this.providerConfig.url,this.$http(e)},x.prototype.openPopup=function(e){var t=[this.providerConfig.authorizationEndpoint,this.buildQueryString(e[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=t,window&&window.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)},x.prototype.exchangeForToken=function(e,t){var o=i({},t);o=i(o,e);var r={};return r.method="POST",r[this.options.requestDataKey]=o,r.withCredentials=this.options.withCredentials,this.options.baseUrl?r.url=s(this.options.baseUrl,this.providerConfig.url):r.url=this.providerConfig.url,this.$http(r)},x.prototype.buildQueryString=function(e){var t=[];for(var o in e){var r=e[o];t.push(encodeURIComponent(o)+"="+encodeURIComponent(r))}return t.join("&")};var A={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}},N=function(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=i({},A),this.providerConfig=i(this.providerConfig,o),this.options=r};N.prototype.init=function(e){var t=this,o=this.providerConfig.name+"_state";n(this.providerConfig.state)?this.storage.setItem(o,this.providerConfig.state()):r(this.providerConfig.state)&&this.storage.setItem(o,this.providerConfig.state);var i=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");return this.oauthPopup=new T(i,this.providerConfig.name,this.providerConfig.popupOptions),new Promise(function(r,n){t.oauthPopup.open(t.providerConfig.redirectUri).then(function(i){if("token"===t.providerConfig.responseType||!t.providerConfig.url)return r(i);if(i.state&&""+i.state!=""+t.storage.getItem(o)){if(!i.state||""+i.state!="")return n(new Error("State parameter value does not match original OAuth request state value see code."));if(window.localStorage.getItem("stateCheck")!==t.storage.getItem(o))return n(new Error("State parameter value does not match original OAuth request state value see code.. See code."))}r(t.exchangeForToken(i,e))}).catch(function(e){n(e)})})},N.prototype.refresh=function(e){var t=this.providerConfig.name+"_state";n(this.providerConfig.state)?this.storage.setItem(t,this.providerConfig.state()):r(this.providerConfig.state)&&this.storage.setItem(t,this.providerConfig.state);var o,a=i({},e);return o=this.options.baseUrl?s(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(o,a,{withCredentials:this.options.withCredentials})},N.prototype.exchangeForToken=function(e,t){var o=this,r=i({},t);for(var n in A.responseParams){switch(n){case"code":r[n]=e.code;break;case"clientId":r[n]=o.providerConfig.clientId;break;case"redirectUri":r[n]=o.providerConfig.redirectUri;break;default:r[n]=e[n]}}e.state&&(r.state=e.state);var a;return a=this.options.baseUrl?s(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(a,r,{withCredentials:this.options.withCredentials})},N.prototype._stringifyRequestParams=function(){var t=this,o=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(function(r){t.providerConfig[r]&&Array.isArray(t.providerConfig[r])&&t.providerConfig[r].forEach(function(r){var i=e(r),s=n(t.providerConfig[r])?t.providerConfig[r]():t.providerConfig[i];if("redirect_uri"!==r||s){if("state"===r){var a=t.providerConfig.name+"_state";s=encodeURIComponent(t.storage.getItem(a))}"scope"===r&&Array.isArray(s)&&(s=s.join(t.providerConfig.scopeDelimiter),t.providerConfig.scopePrefix&&(s=[t.providerConfig.scopePrefix,s].join(t.providerConfig.scopeDelimiter))),o.push([r,s])}})}),o.map(function(e){return e.join("=")}).join("&")};var R=function(e,t){var o=i({},U);o=i(o,t);var r=I(o);if(Object.defineProperties(this,{$http:{get:function(){return e}},options:{get:function(){return o}},storage:{get:function(){return r}},tokenName:{get:function(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),!(this.options.bindRequestInterceptor&&n(this.options.bindRequestInterceptor)&&this.options.bindResponseInterceptor&&n(this.options.bindResponseInterceptor)))throw new Error("Both request and response interceptors must be functions");this.options.bindRequestInterceptor.call(this,this),this.options.bindResponseInterceptor.call(this,this)};return R.prototype.isAuthenticated=function(){var e=this.storage.getItem(this.tokenName);if(e){if(3===e.split(".").length)try{var t=e.split(".")[1],o=t.replace("-","+").replace("_","/"),r=JSON.parse(window.atob(o)).exp;if("number"==typeof r)return Math.round((new Date).getTime()/1e3)<r}catch(e){return!0}return!0}return!1},R.prototype.getToken=function(){return this.storage.getItem(this.tokenName)},R.prototype.getRefreshToken=function(){var e=this.storage.getItem(this.tokenName+"_provider"),t=this.storage.getItem(this.tokenName+"_refresh_token");if(""+e=="undefined"||""+e=="null"||void 0===e||null===e){var o=this.tokenName.replace("vueauth_token","  vueauth_access_token");e=this.storage.getItem(o+"_provider"),e=window.localStorage.getItem("vue-authenticate.vueauth_access_token_provider")}if(""+t=="undefined"||""+t=="null"||void 0===t||null===t){var o=this.tokenName.replace("vueauth_token","  vueauth_access_token");t=this.storage.getItem(o+"_provider"),t=window.localStorage.getItem("vue-authenticate.vueauth_access_token_refresh_token")}return t},R.prototype.isExpiring=function(){var e=new Date/1e3;try{return e>parseInt(this.storage.getItem(this.tokenName+"_expires"))}catch(e){return!1}},R.prototype.Refresh=function(){var e=this;return new g(function(t,o){var r=e.storage.getItem(e.tokenName+"_provider"),n=e.storage.getItem(e.tokenName+"_refresh_token");if(""+r=="undefined"||""+r=="null"||void 0===r||null===r){var i=e.tokenName.replace("vueauth_token","  vueauth_access_token");r=e.storage.getItem(i+"_provider"),r=window.localStorage.getItem("vue-authenticate.vueauth_access_token_provider")}if(""+n=="undefined"||""+n=="null"||void 0===n||null===n){var i=e.tokenName.replace("vueauth_token","  vueauth_access_token");n=e.storage.getItem(i+"_provider"),n=window.localStorage.getItem("vue-authenticate.vueauth_access_token_refresh_token")}if(!r)return t();var s=e.options.providers[r];if(!s)return o(new Error("Unknown provider"));var a;switch(s.oauthType){case"1.0":a=new x(e.$http,e.storage,s,e.options);break;case"2.0":a=new N(e.$http,e.storage,s,e.options);break;default:return o(new Error("Invalid OAuth type"))}if(window.vueAuthLastExecute)return delete window.vueAuthLastExecute,o(new Error("Looping, due to injector..."));window.vueAuthLastExecute=new Date/1e3;var u=e;return a.refresh({clientId:s.clientId,grant_type:"refresh_token",refresh_token:n}).then(function(e){return u.setToken(e),u.isAuthenticated()?(u.storage.setItem(u.tokenName+"_provider",r),t(e)):o(new Error("Authentication failed"))})})},R.prototype.setToken=function(e){e[this.options.responseDataKey]&&(e=e[this.options.responseDataKey]);var t;if(e.access_token&&(o(e.access_token)&&o(e.access_token[this.options.responseDataKey])?e=e.access_token:r(e.access_token)&&(t=e.access_token)),e.expires_in){e.expires_in;var n=new Date/1e3;n=n+e.expires_in-20*e.expires_in/100,this.storage.setItem(this.tokenName+"_expires",n)}e.refresh_token&&this.storage.setItem(this.tokenName+"_refresh_token",e.refresh_token),!t&&e&&(t=e[this.options.tokenName]),t&&this.storage.setItem(this.tokenName,t)},R.prototype.getPayload=function(){var e=this.storage.getItem(this.tokenName);if(e&&3===e.split(".").length)try{var t=e.split(".")[1],o=t.replace("-","+").replace("_","/");return JSON.parse(p(o))}catch(e){}},R.prototype.login=function(e,t){var o=this;return t=t||{},t.url=t.url?t.url:s(this.options.baseUrl,this.options.loginUrl),t[this.options.requestDataKey]=e||t[this.options.requestDataKey],t.method=t.method||"POST",t.withCredentials=t.withCredentials||this.options.withCredentials,this.$http(t).then(function(e){return o.setToken(e),e})},R.prototype.register=function(e,t){var o=this;return t=t||{},t.url=t.url?t.url:s(this.options.baseUrl,this.options.registerUrl),t[this.options.requestDataKey]=e||t[this.options.requestDataKey],t.method=t.method||"POST",t.withCredentials=t.withCredentials||this.options.withCredentials,this.$http(t).then(function(e){return o.setToken(e),e})},R.prototype.logout=function(e){var t=this;return this.storage.removeItem(this.tokenName+"_refresh_token"),this.storage.removeItem(this.tokenName+"_expires"),this.storage.removeItem(this.tokenName+"_provider"),this.isAuthenticated()?(e=e||{},e.url=e.logoutUrl||this.options.logoutUrl,e.url?(e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials,this.$http(e).then(function(e){t.storage.removeItem(t.tokenName)})):(this.storage.removeItem(this.tokenName),g.resolve())):g.reject(new Error("There is no currently authenticated user"))},R.prototype.authenticate=function(e,t,o){var r=this;return new g(function(o,n){var i=r.options.providers[e];if(!i)return n(new Error("Unknown provider"));var s;switch(i.oauthType){case"1.0":s=new x(r.$http,r.storage,i,r.options);break;case"2.0":s=new N(r.$http,r.storage,i,r.options);break;default:return n(new Error("Invalid OAuth type"))}return s.init(t).then(function(t){return r.setToken(t),r.isAuthenticated()?(r.storage.setItem(r.tokenName+"_provider",e),o(t)):n(new Error("Authentication failed"))}).catch(function(e){return n(e)})})},C.factory=function(e,t){return new R(e,t)},C});